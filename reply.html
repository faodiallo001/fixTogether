<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/favicon.png" />
<link rel="apple-touch-icon" href="/favicon.png" />

  <title>Reply to a Fix – FixTogether</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #020617; /* bleu nuit */
      --bg-card: rgba(12, 19, 38, 0.96);
      --accent: #3b82f6;      /* bleu */
      --accent-soft: #60a5fa; /* bleu clair */
      --warm-main: #f7e6b5;   /* beige or */
      --warm-soft: #e7c880;   /* or sable */
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.25);
      --radius-xl: 24px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background:
        radial-gradient(circle at top, #0b1120 0, #020617 50%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    body::before,
    body::after {
      content: "";
      position: fixed;
      inset: -120px;
      pointer-events: none;
      opacity: 0.4;
      mix-blend-mode: screen;
      background:
        radial-gradient(circle at 10% 0%, rgba(56, 189, 248, 0.22), transparent 55%),
        radial-gradient(circle at 90% 20%, rgba(99, 102, 241, 0.2), transparent 55%),
        radial-gradient(circle at 20% 80%, rgba(250, 204, 21, 0.16), transparent 55%);
      z-index: -2;
      animation: drift 16s ease-in-out infinite alternate;
    }

    body::after {
      opacity: 0.18;
      filter: blur(10px);
      animation-duration: 22s;
    }

    @keyframes drift {
      0% { transform: translate3d(0, 0, 0) scale(1); }
      100% { transform: translate3d(10px, -12px, 0) scale(1.03); }
    }

    .page {
      max-width: 1120px;
      margin: 0 auto;
      padding: 32px 16px 64px;
      position: relative;
    }

    .page::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: linear-gradient(
          rgba(148, 163, 184, 0.07) 1px,
          transparent 1px
        ),
        linear-gradient(
          90deg,
          rgba(148, 163, 184, 0.06) 1px,
          transparent 1px
        );
      background-size: 26px 26px;
      opacity: 0.12;
      pointer-events: none;
      z-index: -1;
      mask-image: radial-gradient(circle at top, black 0, black 45%, transparent 100%);
    }

    /* HEADER */

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-mark {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: conic-gradient(
        from 160deg,
        #0ea5e9,
        #6366f1,
        #fbbf24,
        #f97316,
        #0ea5e9
      );
      padding: 2px;
      box-shadow:
        0 0 0 1px rgba(15, 23, 42, 0.8),
        0 0 18px rgba(59, 130, 246, 0.6);
    }

    .logo-mark-inner {
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background: radial-gradient(circle at 30% 10%, #fefce8, #0f172a 55%, #020617 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 600;
      color: #fefce8;
      text-shadow: 0 0 6px rgba(15, 23, 42, 0.8);
    }

    .logo-text-main {
      font-weight: 600;
      letter-spacing: 0.03em;
    }

    .logo-text-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    nav a {
      color: var(--text-muted);
      text-decoration: none;
      font-size: 14px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(15, 23, 42, 0.65);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
    }

    nav a:hover {
      background: rgba(37, 99, 235, 0.2);
      color: #e5e7eb;
      border-color: rgba(96, 165, 250, 0.8);
    }

    /* LAYOUT & CARDS */

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.1fr);
      gap: 24px;
      align-items: flex-start;
    }

    .card {
      position: relative;
      border-radius: var(--radius-xl);
      padding: 20px 18px;
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 24px 80px rgba(15, 23, 42, 0.9);
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      opacity: 0.18;
      background:
        radial-gradient(circle at 0% 0%, rgba(96, 165, 250, 0.23), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(250, 204, 21, 0.2), transparent 55%);
      pointer-events: none;
      z-index: -1;
      filter: blur(2px);
    }

    .hero-title {
      font-size: clamp(24px, 4vw, 30px);
      margin-bottom: 8px;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      text-shadow: 0 0 20px rgba(15, 23, 42, 0.9);
    }

    .hero-title span {
      background: linear-gradient(120deg, #38bdf8, #6366f1, #facc15);
      -webkit-background-clip: text;
      color: transparent;
    }

    .hero-subtitle {
      font-size: 14px;
      color: var(--text-muted);
      line-height: 1.6;
      margin-bottom: 14px;
    }

    .section-title {
      font-size: 15px;
      margin-bottom: 8px;
      font-weight: 600;
    }

    .other-text-block {
      font-size: 13px;
      color: var(--text-main);
      background: rgba(15, 23, 42, 0.9);
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      padding: 10px 12px;
      margin-bottom: 8px;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    .pill {
      display: inline-flex;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(4px);
    }

    /* FORM */

    .field {
      margin-bottom: 14px;
    }

    .field label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
    }

    .field small {
      display: block;
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    input[type="text"],
    input[type="email"],
    textarea {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      padding: 9px 10px;
      font-size: 13px;
      outline: none;
      transition:
        border-color 0.15s ease,
        box-shadow 0.15s ease,
        background 0.15s ease,
        transform 0.1s ease;
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    input::placeholder,
    textarea::placeholder {
      color: #6b7280;
    }

    input:focus,
    textarea:focus {
      border-color: var(--accent-soft);
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.5), 0 0 0 6px rgba(37, 99, 235, 0.18);
      background: rgba(15, 23, 42, 0.96);
      transform: translateY(-0.5px);
    }

    .btn-primary {
      border-radius: 999px;
      padding: 9px 20px;
      border: none;
      cursor: pointer;
      background: linear-gradient(120deg, var(--accent), var(--warm-soft));
      color: #0b1120;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 18px 40px rgba(250, 204, 21, 0.4);
      letter-spacing: 0.03em;
      text-transform: uppercase;
      transition:
        transform 0.15s ease,
        box-shadow 0.15s ease,
        opacity 0.15s ease,
        filter 0.15s ease;
    }

    .btn-primary:hover {
      transform: translateY(-1px) scale(1.01);
      opacity: 0.97;
      filter: saturate(1.05);
      box-shadow: 0 24px 60px rgba(234, 179, 8, 0.55);
    }

    .info-text {
      margin-top: 10px;
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .info-text strong {
      color: var(--warm-main);
      font-weight: 500;
    }

    /* FOOTER */

    footer {
      margin-top: 40px;
      font-size: 11px;
      color: var(--text-muted);
      border-top: 1px solid rgba(15, 23, 42, 0.9);
      padding-top: 16px;
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    footer a {
      color: var(--accent-soft);
      text-decoration: none;
      font-size: 11px;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* RESPONSIVE */

    @media (max-width: 840px) {
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 540px) {
      .page {
        padding-inline: 14px;
      }

      .card {
        padding: 18px 14px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="logo">
        <div class="logo-mark">
          <div class="logo-mark-inner">FT</div>
        </div>
        <div>
          <div class="logo-text-main">FixTogether</div>
          <div class="logo-text-sub">Silent conflict resolution</div>
        </div>
      </div>

      <nav>
        <a href="index.html">Home</a>
      </nav>
    </header>

    <main>
      <div class="layout">
        <!-- LEFT: what they shared -->
        <section class="card">
          <h1 class="hero-title" id="heroTitle">
            Someone invited you to <span>FixTogether</span>
          </h1>
          <p class="hero-subtitle" id="introText">
            You’ve been sent this link because a conflict or misunderstanding has been
            heavy between you. First, read their version. Then you’ll have space
            to give yours calmly, in your own words.
          </p>

          <h2 class="section-title">Here is their version of what happened</h2>

          <div id="otherTitle" class="pill" style="display:none;"></div>

          <div id="otherWhat" class="other-text-block"></div>
          <div id="otherFeel" class="other-text-block" style="display:none;"></div>
          <div id="otherGoal" class="pill" style="display:none;"></div>
        </section>

        <!-- RIGHT: your version -->
        <section class="card">
          <h2 class="section-title">Your version</h2>
          <p class="hero-subtitle">
            This is not about winning or losing. It’s about both of you being heard,
            so FixTogether can create one calmer, fair explanation for both sides
            and send it to your emails.
          </p>

          <form id="replyForm">
           <div class="field">
           <label for="yourName">Your name</label>
           <input id="yourName" type="text" placeholder="Example: faozia" required />
           </div>

            <div class="field">
              <label for="yourEmail">Your email</label>
              <small>We’ll send the final Fix to this address as well.</small>
              <input id="yourEmail" type="email" placeholder="you@example.com" required />
            </div>

            <div class="field">
              <label for="yourView">How do you see the situation?</label>
              <small>Describe what happened from your point of view.</small>
              <textarea id="yourView" placeholder="Write your side here..." required></textarea>
            </div>

            <div class="field">
              <label for="yourFeel">How do you feel about it?</label>
              <small>Hurt, angry, sad, tired, confused… put it into words.</small>
              <textarea id="yourFeel" placeholder="Put your feelings into words here..." required></textarea>
            </div>

            <button type="submit" class="btn-primary">Let’s fix this</button>

            <p class="info-text">
              <strong>Important:</strong> You will not see the final explanation on this page.
              FixTogether reads both sides and sends one neutral, written message directly
              to both of your emails.
            </p>
          </form>
        </section>
      </div>
    </main>

    <footer>
      <div>© <span id="year"></span> FixTogether. All rights reserved.</div>
      <div>
        <a href="index.html">Home</a> ·
        <a href="howitworks.html">How it works</a> ·
        <a href="terms.html">Terms</a> ·
        <a href="privacy.html">Privacy</a>
      </div>
    </footer>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    function getDataFromUrl() {
      const params = new URLSearchParams(window.location.search);
      const raw = params.get("data");
      if (!raw) return null;
      try {
        const base64 = decodeURIComponent(raw);
        const json = decodeURIComponent(escape(atob(base64)));
        return JSON.parse(json);
      } catch (e) {
        console.error("Cannot decode data", e);
        return null;
      }
    }

    const data = getDataFromUrl();

    const heroTitle = document.getElementById("heroTitle");
    const introText = document.getElementById("introText");

    if (!data || !data.what) {
      introText.textContent =
        "The invitation link seems incomplete or expired. Please ask the person who sent it to generate a new one.";
    } else {
      // Titre personnalisé avec le nom de la personne A si disponible
      if (data.name && data.name.trim()) {
        heroTitle.innerHTML =
          `${data.name.trim()} invited you to <span>FixTogether</span>`;
      }

      if (data.title) {
        const t = document.getElementById("otherTitle");
        t.textContent = data.title;
        t.style.display = "inline-flex";
      }
      document.getElementById("otherWhat").textContent = data.what;

      if (data.feel) {
        const f = document.getElementById("otherFeel");
        f.textContent = data.feel;
        f.style.display = "block";
      }
      if (data.goal) {
        const g = document.getElementById("otherGoal");
        g.textContent = "What they hope for: " + data.goal;
        g.style.display = "inline-flex";
      }
    }

    const replyForm = document.getElementById("replyForm");

    replyForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (!data || !data.what || !data.email) {
        alert("The original message could not be loaded. Please ask them to send a new link.");
        return;
      }

      const yourName = document.getElementById("yourName").value.trim();
      const yourEmail = document.getElementById("yourEmail").value.trim();
      const yourView = document.getElementById("yourView").value.trim();
      const yourFeel = document.getElementById("yourFeel").value.trim();

      if (!yourName || !yourEmail || !yourView || !yourFeel) {
        alert("Please fill in your name, email, your version and your feelings.");
        return;
      }

      const payloadA = JSON.stringify(data, null, 2);
      const payloadB =
        `From ${yourName}:\n` +
        yourView +
        "\n\nFeelings:\n" +
        yourFeel;

      try {
        const response = await fetch("/api/create-mediation", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            personA: payloadA,
            personB: payloadB,
            emailA: data.email,
            emailB: yourEmail
          })
        });

        const result = await response.json();

// On vérifie que l'API renvoie bien { success: true }
if (!response.ok || !result.success) {
  console.error("Mediation error:", result);
  alert("Could not complete the Fix. Please try again.");
  return;
}

alert("FixTogether has sent the final message to both of your emails.");
replyForm.reset();

      } catch (err) {
        console.error(err);
        alert("Something went wrong. Please try again.");
      }
    });
  </script>
</body>
</html>




